<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Blocked weighted bootstrap estimation • bbw</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Blocked weighted bootstrap estimation">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bbw</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bbw.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bbw-estimation.html">Blocked weighted bootstrap estimation</a></li>
    <li><a class="dropdown-item" href="../articles/bbw-parallel.html">Using bbw with parallel computation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://fosstodon.org/@katilingban" aria-label="Mastodon"><span class="fa fab fa-mastodon fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.linkedin.com/company/katilingban" aria-label="LinkedIn"><span class="fa fab fa-linkedin fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rapidsurveys/bbw/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Blocked weighted bootstrap estimation</h1>
                        <h4 data-toc-skip class="author">Ernest
Guevarra</h4>
            
            <h4 data-toc-skip class="date">8 January 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rapidsurveys/bbw/blob/main/vignettes/bbw-estimation.Rmd" class="external-link"><code>vignettes/bbw-estimation.Rmd</code></a></small>
      <div class="d-none name"><code>bbw-estimation.Rmd</code></div>
    </div>

    
    
<p>The <a href="https://github.com/rapidsurveys/bbw" class="external-link">bbw</a> package was developed primarily as a tool for
analysing complex sample survey data. It was developed specifically for
use with the <a href="https://rapidsurveys.io/ramOPmanual/" class="external-link">Rapid
Assessment Method (RAM)</a> and the <a href="https://researchonline.lshtm.ac.uk/id/eprint/2572543" class="external-link">Simple
Spatial Survey Method (S3M)</a>.</p>
<p>The <a href="https://rapidsurveys.io/bbw/reference/indicatorsHH.html"><code>indicatorsHH</code></a>
is a survey dataset collected from a RAM survey in Bakool, Bay, and
Middle Shabelle regions of Somalia. The <a href="https://rapidsurveys.io/bbw/reference/villageData.html"><code>villageData</code></a>
contains the list of villages/clusters that were sampled in the survey
that collected the <code>indicatorsHH</code> dataset. These is a good
set of data to demonstrate the use of the <a href="https://github.com/rapidsurveys/bbw" class="external-link">bbw</a> package to
perform blocked weighted bootstrap estimation.</p>
<div class="section level2">
<h2 id="original-bootstrapping-workflow">Original bootstrapping workflow<a class="anchor" aria-label="anchor" href="#original-bootstrapping-workflow"></a>
</h2>
<div class="section level3">
<h3 id="bootstrap-resampling-with-bootbw">Bootstrap resampling with <code>bootBW()</code><a class="anchor" aria-label="anchor" href="#bootstrap-resampling-with-bootbw"></a>
</h3>
<p>The <code><a href="../reference/bootBW.html">bootBW()</a></code> function is the original bootstrap
resampling function of the package. It can be used as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootBW.html">bootBW</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">indicatorsHH</span>, w <span class="op">=</span> <span class="va">villageData</span>, statistic <span class="op">=</span> <span class="va">bootClassic</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anc1"</span>, <span class="st">"anc2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ x has the appropriate/expected data structure</span></span></code></pre></div>
<p>This call to <code><a href="../reference/bootBW.html">bootBW()</a></code> takes in the survey dataset
<code>indicatorsHH</code> as its first argument (<code>x</code>). This
dataset is expected to have a variable labelled as <code>psu</code>
which identifies the primary sampling unit from which data was collected
during the survey and then additional variables for the indicators to be
estimated. The second argument (<code>w</code>) is for the dataset of
the list of primary sampling units that were sampled in the survey to
collect the survey data specified in <code>x</code>. This dataset, which
in this case is <code>villageData</code>, should have at least a
variable labelled <code>psu</code> which identified the primary sampling
unit that matches the same variable in the survey dataset and a variable
labelled <code>pop</code> for the population size of the primary
sampling unit. The <code>statistic</code> argument specified the type of
statistic to apply to the bootstrap replicates. There are two of these
functions available from the <a href="https://github.com/rapidsurveys/bbw" class="external-link">bbw</a> package -
<code><a href="../reference/bootClassic.html">bootClassic()</a></code> and the <code><a href="../reference/bootPROBIT.html">bootPROBIT()</a></code>. For this
example, the <code><a href="../reference/bootClassic.html">bootClassic()</a></code> function is used to get the mean
value of the bootstrap replicates. This is generally useful for binomial
type of indicators and for continuous variables of which to get the mean
of. The <code>params</code> argument takes in values of the indicator
names in <code>x</code> to be estimated. In this example, two indicator
names for antenatal care are specified. Finally, the argument for
<code>replicates</code> specify the number of replicate bootstraps to be
performed. The default of 400 replicates is used here. This results in
the following (showing first 10 rows):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boot_df</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         anc1       anc2</span></span>
<span><span class="co">#&gt; 1  0.1864175 0.01874714</span></span>
<span><span class="co">#&gt; 2  0.2290978 0.02035985</span></span>
<span><span class="co">#&gt; 3  0.2343529 0.02641509</span></span>
<span><span class="co">#&gt; 4  0.2548555 0.03084955</span></span>
<span><span class="co">#&gt; 5  0.2698864 0.02662863</span></span>
<span><span class="co">#&gt; 6  0.2151356 0.01819052</span></span>
<span><span class="co">#&gt; 7  0.1937834 0.02677702</span></span>
<span><span class="co">#&gt; 8  0.2148349 0.01678766</span></span>
<span><span class="co">#&gt; 9  0.2593480 0.02891566</span></span>
<span><span class="co">#&gt; 10 0.2151414 0.01922153</span></span></code></pre></div>
<p>The result is a <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code> of bootstrap replicates
with number of rows equal to the number or replicates and number of
columns equal to the number of <code>params</code> specified. Hence,
<code>boot_df</code> has 400 rows and 2 columns.</p>
</div>
<div class="section level3">
<h3 id="bootstrap-estimation">Bootstrap estimation<a class="anchor" aria-label="anchor" href="#bootstrap-estimation"></a>
</h3>
<p>Using <code>boot_df</code> containing bootstrap replicates of the
indicators <code>anc1</code> and <code>anc2</code>, estimating each
indicator with a 95% confidence interval using the <em>percentile
bootstrap method</em>. This can be simply done using the
<code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code> function from the <code>stats</code> package as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">boot_df</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">quantile</span>,</span>
<span>  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, args <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile()</a></code> function is used to get the 50th
percentile (for the estimate) and the 2.5th and the 97.5th percentile of
the bootstrap replicates to get the lower confidence limit and the upper
confidence limits (respectively) of the indicator estimate. This gives
the following results:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_df</span></span>
<span><span class="co">#&gt;            50%       2.5%      97.5%</span></span>
<span><span class="co">#&gt; anc1 0.2316597 0.17709920 0.28849265</span></span>
<span><span class="co">#&gt; anc2 0.0218962 0.01347537 0.03484835</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stratified-bootstrap-resampling">Stratified bootstrap resampling<a class="anchor" aria-label="anchor" href="#stratified-bootstrap-resampling"></a>
</h3>
<p>Note that the <code>indicatorsHH</code> dataset has geographical
stratification. Specifically, the survey from which this data was
collected was designed to be representative of three regions in Somalia
with the regions identified through the <code>region</code> variable in
<code>indicatorsHH</code>. Because of this the more appropriate
bootstrap resampling approach would be to resample within each region.
To do this using the original <code><a href="../reference/bootBW.html">bootBW()</a></code> function would
require restructuring the survey dataset by region and then passing the
region-stratified datasets individually to the <code><a href="../reference/bootBW.html">bootBW()</a></code>
function. This may look something like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Split indicators by region ----</span></span>
<span><span class="va">indicators_by_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">indicatorsHH</span>, f <span class="op">=</span> <span class="va">indicatorsHH</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Split psus by region ----</span></span>
<span><span class="va">psus_by_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">villageData</span>, f <span class="op">=</span> <span class="va">villageData</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Bootstrap</span></span>
<span><span class="va">boot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span></span>
<span>  f <span class="op">=</span> <span class="va">bootBW</span>, </span>
<span>  x <span class="op">=</span> <span class="va">indicators_by_region</span>, </span>
<span>  w <span class="op">=</span> <span class="va">psus_by_region</span>, </span>
<span>  statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"bootClassic"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">indicators_by_region</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anc1"</span>, <span class="st">"anc2"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">indicators_by_region</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ x has the appropriate/expected data structure</span></span>
<span><span class="co">#&gt; ✔ x has the appropriate/expected data structure</span></span>
<span><span class="co">#&gt; ✔ x has the appropriate/expected data structure</span></span></code></pre></div>
<p>The <code><a href="../reference/bootBW.html">bootBW()</a></code> function only accepts single
<code>data.frame</code> inputs for <code>x</code> and <code>w</code>
arguments. Hence, to resample data from within region, the datasets will
have to be split into separate <code>data.frame</code> inputs per region
and then <code><a href="../reference/bootBW.html">bootBW()</a></code> applied to each separately. In the
example above, this is done by concatenating each of the inputs to
<code><a href="../reference/bootBW.html">bootBW()</a></code> into a list and then using the <code><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map()</a></code>
function is sent to <code><a href="../reference/bootBW.html">bootBW()</a></code> sequentially. This produces a
list of the <code>data.frame</code> bootstrap resample for each region
(shown below):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">$</span><span class="va">Bay</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         anc1        anc2</span></span>
<span><span class="co">#&gt; 1  0.4043419 0.013568521</span></span>
<span><span class="co">#&gt; 2  0.3907104 0.020491803</span></span>
<span><span class="co">#&gt; 3  0.3224044 0.023224044</span></span>
<span><span class="co">#&gt; 4  0.2645862 0.016282225</span></span>
<span><span class="co">#&gt; 5  0.2708618 0.008207934</span></span>
<span><span class="co">#&gt; 6  0.3297151 0.024423338</span></span>
<span><span class="co">#&gt; 7  0.3627717 0.004076087</span></span>
<span><span class="co">#&gt; 8  0.3662551 0.016460905</span></span>
<span><span class="co">#&gt; 9  0.3410641 0.016371078</span></span>
<span><span class="co">#&gt; 10 0.2277628 0.014824798</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">$</span><span class="va">Bakool</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         anc1       anc2</span></span>
<span><span class="co">#&gt; 1  0.2916667 0.17415730</span></span>
<span><span class="co">#&gt; 2  0.2928177 0.09497207</span></span>
<span><span class="co">#&gt; 3  0.3260274 0.14804469</span></span>
<span><span class="co">#&gt; 4  0.2747253 0.11864407</span></span>
<span><span class="co">#&gt; 5  0.2900552 0.11797753</span></span>
<span><span class="co">#&gt; 6  0.1823204 0.05849582</span></span>
<span><span class="co">#&gt; 7  0.4065934 0.16343490</span></span>
<span><span class="co">#&gt; 8  0.2727273 0.11731844</span></span>
<span><span class="co">#&gt; 9  0.2821918 0.06944444</span></span>
<span><span class="co">#&gt; 10 0.2939560 0.09749304</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">$</span><span class="va">`Middle Shabelle`</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;         anc1        anc2</span></span>
<span><span class="co">#&gt; 1  0.1723447 0.011055276</span></span>
<span><span class="co">#&gt; 2  0.2550607 0.018367347</span></span>
<span><span class="co">#&gt; 3  0.1330724 0.010816126</span></span>
<span><span class="co">#&gt; 4  0.2830189 0.024551464</span></span>
<span><span class="co">#&gt; 5  0.1921569 0.014792899</span></span>
<span><span class="co">#&gt; 6  0.2217782 0.010989011</span></span>
<span><span class="co">#&gt; 7  0.2117647 0.007881773</span></span>
<span><span class="co">#&gt; 8  0.2165156 0.019172553</span></span>
<span><span class="co">#&gt; 9  0.2195122 0.015625000</span></span>
<span><span class="co">#&gt; 10 0.2274549 0.015075377</span></span></code></pre></div>
<p>To estimate the per region results from this bootstrap resampling,
the following can be implemented:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">boot_df</span>, </span>
<span>  FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, FUN <span class="op">=</span> <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, args <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">est_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">est_df</span><span class="op">)</span>,</span>
<span>  indicators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">est_df</span>, FUN <span class="op">=</span> <span class="va">row.names</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, args <span class="op">=</span> <span class="va">est_df</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">est_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>which results in the following output:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_df</span></span>
<span><span class="co">#&gt;            region indicators       X50.       X2.5.     X97.5.</span></span>
<span><span class="co">#&gt; 1          Bakool       anc1 0.30261405 0.188862799 0.41167127</span></span>
<span><span class="co">#&gt; 2             Bay       anc2 0.11251780 0.050903865 0.19504237</span></span>
<span><span class="co">#&gt; 3 Middle Shabelle       anc1 0.32391543 0.217411669 0.43781930</span></span>
<span><span class="co">#&gt; 4          Bakool       anc2 0.01893172 0.002766156 0.03663750</span></span>
<span><span class="co">#&gt; 5             Bay       anc1 0.20220114 0.134820317 0.27676772</span></span>
<span><span class="co">#&gt; 6 Middle Shabelle       anc2 0.01724140 0.007237952 0.03006251</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="alternative-blocked-weighted-bootstrap-function-set">Alternative blocked weighted bootstrap function set<a class="anchor" aria-label="anchor" href="#alternative-blocked-weighted-bootstrap-function-set"></a>
</h2>
<p>From this demonstration, the <code><a href="../reference/bootBW.html">bootBW()</a></code> function proves to
be straightforward to implement and can be easily incorporated into a
user’s workflow based on their dataset and their analytic needs.
However, as shown above, this flexibility requires a lot more extra
coding from the user to get from resampling to indicator estimates.</p>
<p>Starting from <code>v0.3.0</code>, an alternative set of functions is
available to perform blocked weighted bootstrap resampling that
facilitates all the steps from resampling to estimation. Below is an
example of how to use this alternative set of functions for the same
tasks shown above.</p>
<p>This set of functions attempts to make the blocked weighted bootstrap
algorithm more efficient through vectorisation and use of
parallelisation techniques. The function syntax has been kept consistent
with <code><a href="../reference/bootBW.html">bootBW()</a></code> for ease of transition.</p>
<div class="section level3">
<h3 id="bootstrap-resampling-with-boot_bw">Bootstrap resampling with <code>boot_bw()</code><a class="anchor" aria-label="anchor" href="#bootstrap-resampling-with-boot_bw"></a>
</h3>
<p>The <code><a href="../reference/boot_bw.html">boot_bw()</a></code> function is the alternative bootstrap
resampling function of the package. It can be used as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boot_bw.html">boot_bw</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">indicatorsHH</span>, w <span class="op">=</span> <span class="va">villageData</span>, statistic <span class="op">=</span> <span class="va">bootClassic</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anc1"</span>, <span class="st">"anc2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This call to <code><a href="../reference/boot_bw.html">boot_bw()</a></code> takes in the survey dataset
<code>indicatorsHH</code> as its first argument (<code>x</code>). This
dataset is expected to have a variable labelled as <code>psu</code>
which identifies the primary sampling unit from which data was collected
during the survey and then additional variables for the indicators to be
estimated. The second argument (<code>w</code>) is for the dataset of
the list of primary sampling units that were sampled in the survey to
collect the survey data specified in <code>x</code>. This dataset, which
in this case is <code>villageData</code>, should have at least a
variable labelled <code>psu</code> which identified the primary sampling
unit that matches the same variable in the survey dataset and a variable
labelled <code>pop</code> for the population size of the primary
sampling unit. The <code>statistic</code> argument specified the type of
statistic to apply to the bootstrap replicates. There are two of these
functions available from the <a href="https://github.com/rapidsurveys/bbw" class="external-link">bbw</a> package -
<code><a href="../reference/bootClassic.html">bootClassic()</a></code> and the <code><a href="../reference/bootPROBIT.html">bootPROBIT()</a></code>. For this
example, the <code><a href="../reference/bootClassic.html">bootClassic()</a></code> function is used to get the mean
value of the bootstrap replicates. This is generally useful for binomial
type of indicators and for continuous variables of which to get the mean
of. The <code>params</code> argument takes in values of the indicator
names in <code>x</code> to be estimated. In this example, two indicator
names for antenatal care are specified. Finally, the argument for
<code>replicates</code> specify the number of replicate bootstraps to be
performed. The default of 400 replicates is used here. As can be noted,
the <code><a href="../reference/boot_bw.html">boot_bw()</a></code> takes on the same type of arguments as
<code><a href="../reference/bootBW.html">bootBW()</a></code> and the syntax is exactly the same. Hence, using
this alternative function will be familiar to those who have had
experience using the original function.</p>
<p>However, the output of the <code><a href="../reference/boot_bw.html">boot_bw()</a></code> function is
structured differently from the <code><a href="../reference/bootBW.html">bootBW()</a></code> function. The
<code><a href="../reference/boot_bw.html">boot_bw()</a></code> function produces and object of class
<code>boot_bw</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "boot_bw"</span></span></code></pre></div>
<p>The object <code>boot_bw</code> is a list with 4 named components:
<code>params</code> for the values specified for the <code>params</code>
argument, <code>replicates</code> for the number of bootstrap replicates
performed, <code>strata</code> for the values specified for
stratification, and <code>boot_data</code> which is the bootstrap
results.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "params"     "replicates" "strata"     "boot_data"</span></span></code></pre></div>
<p>The <code>boot_data</code> component of the <code>boot_bw</code>
object corresponds to the output of the <code><a href="../reference/bootBW.html">bootBW()</a></code>
function.</p>
<p>Other than the difference in the structure of the output, this
alternative function also has three additional arguments for the new
features it provides.</p>
<ul>
<li><p><code>strata</code> - the variable name in <code>x</code> that
provides information on the stratification in the survey data. This is
by default set to <code>NULL</code> signifying no stratification. This
argument allows the user to perform stratified bootstrap resampling
conveniently through the <code><a href="../reference/boot_bw.html">boot_bw()</a></code> function.</p></li>
<li><p><code>parallel</code> - whether or not to use parallel
computation for the bootstrap resampling. This is by default set to
FALSE in which case bootstrap resampling is done sequentially as is with
the <code><a href="../reference/bootBW.html">bootBW()</a></code> function. If set to TRUE, the function sets up
parallel computing and utilises the machines available cores (see
<code>cores</code> argument below).</p></li>
<li><p><code>cores</code> - the number of cores to use for parallel
computation. This is only evaluated if <code>parallel = TRUE</code>. By
default, this is set to 1 less the total available number of cores of
the current machine.</p></li>
</ul>
<p>To use these new features and functionality, the call to
<code><a href="../reference/boot_bw.html">boot_bw()</a></code> would look something like this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boot_bw.html">boot_bw</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">indicatorsHH</span>, w <span class="op">=</span> <span class="va">villageData</span>, statistic <span class="op">=</span> <span class="va">bootClassic</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anc1"</span>, <span class="st">"anc2"</span><span class="op">)</span>, strata <span class="op">=</span> <span class="st">"region"</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This produces a <code>boot_bw</code> class <code>list</code> object
with the same components as above. The only different is that the
<code>boot_data</code> component is a <code>list</code> (instead of a
<code>data.frame</code>) with each component being the
<code>data.frame</code> bootstrap resampling output for each of the
strata in the dataset.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "boot_bw"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">$</span><span class="va">boot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">$</span><span class="va">boot_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Bakool"          "Bay"             "Middle Shabelle"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bootstrap-estimation-1">Bootstrap estimation<a class="anchor" aria-label="anchor" href="#bootstrap-estimation-1"></a>
</h3>
<p>The <code><a href="../reference/boot_bw_estimate.html">boot_bw_estimate()</a></code> function can then be applied to
the output of the <code><a href="../reference/boot_bw.html">boot_bw()</a></code> function to get the indicator
estimates with 95% confidence interval.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/boot_bw_estimate.html">boot_bw_estimate</a></span><span class="op">(</span><span class="va">boot_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;            region indicator        est        lcl        ucl</span></span>
<span><span class="co">#&gt; 1          Bakool      anc1 0.43888889 0.38881944 0.48888889</span></span>
<span><span class="co">#&gt; 2          Bakool      anc2 0.38055556 0.32497749 0.43062500</span></span>
<span><span class="co">#&gt; 3             Bay      anc1 0.71619066 0.63887512 0.77849135</span></span>
<span><span class="co">#&gt; 4             Bay      anc2 0.00254615 0.00000000 0.01294677</span></span>
<span><span class="co">#&gt; 5 Middle Shabelle      anc1 0.20757542 0.14514451 0.28293531</span></span>
<span><span class="co">#&gt; 6 Middle Shabelle      anc2 0.05065259 0.03133757 0.07453108</span></span>
<span><span class="co">#&gt;            se</span></span>
<span><span class="co">#&gt; 1 0.027718319</span></span>
<span><span class="co">#&gt; 2 0.027983726</span></span>
<span><span class="co">#&gt; 3 0.036466569</span></span>
<span><span class="co">#&gt; 4 0.003743969</span></span>
<span><span class="co">#&gt; 5 0.036375151</span></span>
<span><span class="co">#&gt; 6 0.011463590</span></span></code></pre></div>
<p>These two functions can be piped to each other for a single workflow
from bootstrap resampling to estimation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/boot_bw.html">boot_bw</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">indicatorsHH</span>, w <span class="op">=</span> <span class="va">villageData</span>, statistic <span class="op">=</span> <span class="va">bootClassic</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anc1"</span>, <span class="st">"anc2"</span><span class="op">)</span>, strata <span class="op">=</span> <span class="st">"region"</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/boot_bw_estimate.html">boot_bw_estimate</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            region indicator         est       lcl        ucl</span></span>
<span><span class="co">#&gt; 1          Bakool      anc1 0.438888889 0.3805556 0.49444444</span></span>
<span><span class="co">#&gt; 2          Bakool      anc2 0.376731302 0.3138889 0.43888889</span></span>
<span><span class="co">#&gt; 3             Bay      anc1 0.719130072 0.6487833 0.78255787</span></span>
<span><span class="co">#&gt; 4             Bay      anc2 0.002534854 0.0000000 0.01262706</span></span>
<span><span class="co">#&gt; 5 Middle Shabelle      anc1 0.203423968 0.1428536 0.27819673</span></span>
<span><span class="co">#&gt; 6 Middle Shabelle      anc2 0.051256281 0.0339071 0.07622767</span></span>
<span><span class="co">#&gt;            se</span></span>
<span><span class="co">#&gt; 1 0.030425611</span></span>
<span><span class="co">#&gt; 2 0.030033802</span></span>
<span><span class="co">#&gt; 3 0.034273078</span></span>
<span><span class="co">#&gt; 4 0.003372086</span></span>
<span><span class="co">#&gt; 5 0.033966913</span></span>
<span><span class="co">#&gt; 6 0.010573679</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Myatt, Ernest Guevarra.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
